[15:00:34 INF] [] Request starting HTTP/1.1 OPTIONS http://localhost:5000/api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a - null null
[15:00:34 INF] [] Request starting HTTP/1.1 POST http://localhost:5000/api/webhooks/stripe - application/json; charset=utf-8 2060
[15:00:34 INF] [] CORS policy execution successful.
[15:00:34 INF] [] Request finished HTTP/1.1 OPTIONS http://localhost:5000/api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a - 204 null null 133.5008ms
[15:00:34 INF] [] Request starting HTTP/1.1 GET http://localhost:5000/api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a - application/json null
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Executing endpoint 'Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi)'
[15:00:34 INF] [] Request starting HTTP/1.1 POST http://localhost:5000/api/webhooks/stripe - application/json; charset=utf-8 3761
[15:00:34 INF] [f85cab81a8f4ff172efeee1dea1c6fb4] Executing endpoint 'Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi)'
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Route matched with {action = "Handle", controller = "StripeWebhooks"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Handle(System.Threading.CancellationToken) on controller Ecommerce.WebApi.Controllers.Public.StripeWebhooksController (Ecommerce.WebApi).
[15:00:34 INF] [f85cab81a8f4ff172efeee1dea1c6fb4] Route matched with {action = "Handle", controller = "StripeWebhooks"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Handle(System.Threading.CancellationToken) on controller Ecommerce.WebApi.Controllers.Public.StripeWebhooksController (Ecommerce.WebApi).
[15:00:34 INF] [] CORS policy execution successful.
[15:00:34 INF] [3032f4d44957e90638b9907c7b144dac] Executing endpoint 'Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi)'
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Executing action method Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi) - Validation state: "Valid"
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Stripe webhook endpoint hit.
[15:00:34 INF] [f85cab81a8f4ff172efeee1dea1c6fb4] Executing action method Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi) - Validation state: "Valid"
[15:00:34 INF] [f85cab81a8f4ff172efeee1dea1c6fb4] Stripe webhook endpoint hit.
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Stripe webhook event type: payment_intent.succeeded
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Stripe webhook received
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Stripe webhook is payment_intent.succeeded; orderPublicId metadata: 1d40e0ba-92dc-442b-ab48-4043a8076c8a
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Calling MarkPaidByPublicIdAsync for order "1d40e0ba-92dc-442b-ab48-4043a8076c8a"
[15:00:34 INF] [3032f4d44957e90638b9907c7b144dac] Route matched with {action = "GetByPublicId", controller = "Orders"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Ecommerce.Application.Features.Orders.Models.OrderDto]] GetByPublicId(System.Guid, System.Threading.CancellationToken) on controller Ecommerce.WebApi.Controllers.Public.OrdersController (Ecommerce.WebApi).
[15:00:34 INF] [3032f4d44957e90638b9907c7b144dac] Executing action method Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi) - Validation state: "Valid"
[15:00:34 INF] [f85cab81a8f4ff172efeee1dea1c6fb4] Stripe webhook event type: charge.succeeded
[15:00:34 INF] [f85cab81a8f4ff172efeee1dea1c6fb4] Stripe webhook received
[15:00:34 INF] [f85cab81a8f4ff172efeee1dea1c6fb4] Executed action method Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi), returned result Microsoft.AspNetCore.Mvc.OkResult in 183.0509ms.
[15:00:34 INF] [f85cab81a8f4ff172efeee1dea1c6fb4] Executing StatusCodeResult, setting HTTP status code 200
[15:00:34 INF] [f85cab81a8f4ff172efeee1dea1c6fb4] Executed action Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi) in 250.444ms
[15:00:34 INF] [f85cab81a8f4ff172efeee1dea1c6fb4] Executed endpoint 'Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi)'
[15:00:34 INF] [f85cab81a8f4ff172efeee1dea1c6fb4] HTTP POST /api/webhooks/stripe responded 200 in 269.5169 ms
[15:00:34 INF] [] Request finished HTTP/1.1 POST http://localhost:5000/api/webhooks/stripe - 200 0 null 271.114ms
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Executed DbCommand (16ms) [Parameters=[@__publicId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT o.status
FROM orders AS o
WHERE o.public_id = @__publicId_0
LIMIT 1
[15:00:34 INF] [3032f4d44957e90638b9907c7b144dac] Executed DbCommand (17ms) [Parameters=[@__publicId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT t.public_id, t.c, t.currency, t.subtotal_amount, t.discount_amount, t.tax_amount, t.total_amount, t.id, COALESCE(o0.product_id, 0), o0.product_name, o0.unit_price, o0.quantity, o0.line_total, o0.id
FROM (
    SELECT o.public_id, o.status::smallint AS c, o.currency, o.subtotal_amount, o.discount_amount, o.tax_amount, o.total_amount, o.id
    FROM orders AS o
    WHERE o.public_id = @__publicId_0
    LIMIT 1
) AS t
LEFT JOIN order_items AS o0 ON t.id = o0.order_id
ORDER BY t.id, o0.id
[15:00:34 INF] [3032f4d44957e90638b9907c7b144dac] Executed action method Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi), returned result Microsoft.AspNetCore.Mvc.OkObjectResult in 330.7091ms.
[15:00:34 INF] [3032f4d44957e90638b9907c7b144dac] Executing OkObjectResult, writing value of type 'Ecommerce.Application.Features.Orders.Models.OrderDto'.
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Executed DbCommand (3ms) [Parameters=[@__publicId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM orders AS o
    WHERE o.public_id = @__publicId_0)
[15:00:34 INF] [3032f4d44957e90638b9907c7b144dac] Executed action Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi) in 356.9604ms
[15:00:34 INF] [3032f4d44957e90638b9907c7b144dac] Executed endpoint 'Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi)'
[15:00:34 INF] [3032f4d44957e90638b9907c7b144dac] HTTP GET /api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a responded 200 in 486.3315 ms
[15:00:34 INF] [] Request finished HTTP/1.1 GET http://localhost:5000/api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a - 200 null application/json; charset=utf-8 510.3814ms
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Executed DbCommand (0ms) [Parameters=[@__publicId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT o.id, o.created_at, o.currency, o.customer_email, o.discount_amount, o.public_id, o.status, o.subtotal_amount, o.tax_amount, o.total_amount, o.updated_at
FROM orders AS o
WHERE o.public_id = @__publicId_0
LIMIT 1
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Executed DbCommand (4ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Int16), @p1='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE orders SET status = @p0, updated_at = @p1
WHERE id = @p2;
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Order status updated
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Executed action method Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi), returned result Microsoft.AspNetCore.Mvc.OkResult in 520.7745ms.
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Executing StatusCodeResult, setting HTTP status code 200
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Executed action Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi) in 576.9851ms
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] Executed endpoint 'Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi)'
[15:00:34 INF] [427a456002bc9c1ca46eff128c4b71c8] HTTP POST /api/webhooks/stripe responded 200 in 600.7023 ms
[15:00:34 INF] [] Request finished HTTP/1.1 POST http://localhost:5000/api/webhooks/stripe - 200 0 null 676.9013ms
[15:00:36 INF] [] Request starting HTTP/1.1 POST http://localhost:5000/api/webhooks/stripe - application/json; charset=utf-8 3986
[15:00:36 INF] [1d64388d89a0e078421c81ae7418eaf5] Executing endpoint 'Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi)'
[15:00:36 INF] [1d64388d89a0e078421c81ae7418eaf5] Route matched with {action = "Handle", controller = "StripeWebhooks"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Handle(System.Threading.CancellationToken) on controller Ecommerce.WebApi.Controllers.Public.StripeWebhooksController (Ecommerce.WebApi).
[15:00:36 INF] [1d64388d89a0e078421c81ae7418eaf5] Executing action method Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi) - Validation state: "Valid"
[15:00:36 INF] [1d64388d89a0e078421c81ae7418eaf5] Stripe webhook endpoint hit.
[15:00:36 INF] [1d64388d89a0e078421c81ae7418eaf5] Stripe webhook event type: charge.updated
[15:00:36 INF] [1d64388d89a0e078421c81ae7418eaf5] Stripe webhook received
[15:00:36 INF] [1d64388d89a0e078421c81ae7418eaf5] Executed action method Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi), returned result Microsoft.AspNetCore.Mvc.OkResult in 22.6469ms.
[15:00:36 INF] [1d64388d89a0e078421c81ae7418eaf5] Executing StatusCodeResult, setting HTTP status code 200
[15:00:36 INF] [1d64388d89a0e078421c81ae7418eaf5] Executed action Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi) in 25.2152ms
[15:00:36 INF] [1d64388d89a0e078421c81ae7418eaf5] Executed endpoint 'Ecommerce.WebApi.Controllers.Public.StripeWebhooksController.Handle (Ecommerce.WebApi)'
[15:00:36 INF] [1d64388d89a0e078421c81ae7418eaf5] HTTP POST /api/webhooks/stripe responded 200 in 26.7713 ms
[15:00:36 INF] [] Request finished HTTP/1.1 POST http://localhost:5000/api/webhooks/stripe - 200 0 null 32.4455ms
[15:00:37 INF] [] Request starting HTTP/1.1 GET http://localhost:5000/api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a - application/json null
[15:00:37 INF] [] CORS policy execution successful.
[15:00:37 INF] [cac56aa86e8539b85c011d8859afd71f] Executing endpoint 'Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi)'
[15:00:38 INF] [cac56aa86e8539b85c011d8859afd71f] Route matched with {action = "GetByPublicId", controller = "Orders"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Ecommerce.Application.Features.Orders.Models.OrderDto]] GetByPublicId(System.Guid, System.Threading.CancellationToken) on controller Ecommerce.WebApi.Controllers.Public.OrdersController (Ecommerce.WebApi).
[15:00:38 INF] [cac56aa86e8539b85c011d8859afd71f] Executing action method Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi) - Validation state: "Valid"
[15:00:38 INF] [cac56aa86e8539b85c011d8859afd71f] Executed DbCommand (6ms) [Parameters=[@__publicId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT t.public_id, t.c, t.currency, t.subtotal_amount, t.discount_amount, t.tax_amount, t.total_amount, t.id, COALESCE(o0.product_id, 0), o0.product_name, o0.unit_price, o0.quantity, o0.line_total, o0.id
FROM (
    SELECT o.public_id, o.status::smallint AS c, o.currency, o.subtotal_amount, o.discount_amount, o.tax_amount, o.total_amount, o.id
    FROM orders AS o
    WHERE o.public_id = @__publicId_0
    LIMIT 1
) AS t
LEFT JOIN order_items AS o0 ON t.id = o0.order_id
ORDER BY t.id, o0.id
[15:00:38 INF] [cac56aa86e8539b85c011d8859afd71f] Executed action method Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi), returned result Microsoft.AspNetCore.Mvc.OkObjectResult in 24.5348ms.
[15:00:38 INF] [cac56aa86e8539b85c011d8859afd71f] Executing OkObjectResult, writing value of type 'Ecommerce.Application.Features.Orders.Models.OrderDto'.
[15:00:38 INF] [cac56aa86e8539b85c011d8859afd71f] Executed action Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi) in 36.3227ms
[15:00:38 INF] [cac56aa86e8539b85c011d8859afd71f] Executed endpoint 'Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi)'
[15:00:38 INF] [cac56aa86e8539b85c011d8859afd71f] HTTP GET /api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a responded 200 in 286.4891 ms
[15:00:38 INF] [] Request finished HTTP/1.1 GET http://localhost:5000/api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a - 200 null application/json; charset=utf-8 294.525ms
[15:05:42 INF] [] Request starting HTTP/1.1 OPTIONS http://localhost:5000/api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a - null null
[15:05:42 INF] [] CORS policy execution successful.
[15:05:42 INF] [] Request finished HTTP/1.1 OPTIONS http://localhost:5000/api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a - 204 null null 31.8498ms
[15:05:42 INF] [] Request starting HTTP/1.1 GET http://localhost:5000/api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a - application/json null
[15:05:42 INF] [] CORS policy execution successful.
[15:05:42 INF] [858eeb783113aacb0221f5f96647cd2a] Executing endpoint 'Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi)'
[15:05:42 INF] [858eeb783113aacb0221f5f96647cd2a] Route matched with {action = "GetByPublicId", controller = "Orders"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Ecommerce.Application.Features.Orders.Models.OrderDto]] GetByPublicId(System.Guid, System.Threading.CancellationToken) on controller Ecommerce.WebApi.Controllers.Public.OrdersController (Ecommerce.WebApi).
[15:05:42 INF] [858eeb783113aacb0221f5f96647cd2a] Executing action method Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi) - Validation state: "Valid"
[15:05:43 INF] [858eeb783113aacb0221f5f96647cd2a] Executed DbCommand (14ms) [Parameters=[@__publicId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT t.public_id, t.c, t.currency, t.subtotal_amount, t.discount_amount, t.tax_amount, t.total_amount, t.id, COALESCE(o0.product_id, 0), o0.product_name, o0.unit_price, o0.quantity, o0.line_total, o0.id
FROM (
    SELECT o.public_id, o.status::smallint AS c, o.currency, o.subtotal_amount, o.discount_amount, o.tax_amount, o.total_amount, o.id
    FROM orders AS o
    WHERE o.public_id = @__publicId_0
    LIMIT 1
) AS t
LEFT JOIN order_items AS o0 ON t.id = o0.order_id
ORDER BY t.id, o0.id
[15:05:43 INF] [858eeb783113aacb0221f5f96647cd2a] Executed action method Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi), returned result Microsoft.AspNetCore.Mvc.OkObjectResult in 176.542ms.
[15:05:43 INF] [858eeb783113aacb0221f5f96647cd2a] Executing OkObjectResult, writing value of type 'Ecommerce.Application.Features.Orders.Models.OrderDto'.
[15:05:43 INF] [858eeb783113aacb0221f5f96647cd2a] Executed action Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi) in 241.8612ms
[15:05:43 INF] [858eeb783113aacb0221f5f96647cd2a] Executed endpoint 'Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi)'
[15:05:43 INF] [858eeb783113aacb0221f5f96647cd2a] HTTP GET /api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a responded 200 in 270.4303 ms
[15:05:43 INF] [] Request finished HTTP/1.1 GET http://localhost:5000/api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a - 200 null application/json; charset=utf-8 278.293ms
[15:05:44 INF] [] Request starting HTTP/1.1 GET http://localhost:5000/api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a - application/json null
[15:05:44 INF] [] CORS policy execution successful.
[15:05:44 INF] [f8df2e108a763f3c2fbcc1b725879c51] Executing endpoint 'Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi)'
[15:05:44 INF] [f8df2e108a763f3c2fbcc1b725879c51] Route matched with {action = "GetByPublicId", controller = "Orders"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Ecommerce.Application.Features.Orders.Models.OrderDto]] GetByPublicId(System.Guid, System.Threading.CancellationToken) on controller Ecommerce.WebApi.Controllers.Public.OrdersController (Ecommerce.WebApi).
[15:05:44 INF] [f8df2e108a763f3c2fbcc1b725879c51] Executing action method Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi) - Validation state: "Valid"
[15:05:44 INF] [f8df2e108a763f3c2fbcc1b725879c51] Executed DbCommand (2ms) [Parameters=[@__publicId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT t.public_id, t.c, t.currency, t.subtotal_amount, t.discount_amount, t.tax_amount, t.total_amount, t.id, COALESCE(o0.product_id, 0), o0.product_name, o0.unit_price, o0.quantity, o0.line_total, o0.id
FROM (
    SELECT o.public_id, o.status::smallint AS c, o.currency, o.subtotal_amount, o.discount_amount, o.tax_amount, o.total_amount, o.id
    FROM orders AS o
    WHERE o.public_id = @__publicId_0
    LIMIT 1
) AS t
LEFT JOIN order_items AS o0 ON t.id = o0.order_id
ORDER BY t.id, o0.id
[15:05:44 INF] [f8df2e108a763f3c2fbcc1b725879c51] Executed action method Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi), returned result Microsoft.AspNetCore.Mvc.OkObjectResult in 9.5542ms.
[15:05:44 INF] [f8df2e108a763f3c2fbcc1b725879c51] Executing OkObjectResult, writing value of type 'Ecommerce.Application.Features.Orders.Models.OrderDto'.
[15:05:44 INF] [f8df2e108a763f3c2fbcc1b725879c51] Executed action Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi) in 10.7056ms
[15:05:44 INF] [f8df2e108a763f3c2fbcc1b725879c51] Executed endpoint 'Ecommerce.WebApi.Controllers.Public.OrdersController.GetByPublicId (Ecommerce.WebApi)'
[15:05:44 INF] [f8df2e108a763f3c2fbcc1b725879c51] HTTP GET /api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a responded 200 in 11.4232 ms
[15:05:44 INF] [] Request finished HTTP/1.1 GET http://localhost:5000/api/orders/1d40e0ba-92dc-442b-ab48-4043a8076c8a - 200 null application/json; charset=utf-8 12.5305ms
